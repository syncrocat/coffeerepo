<html>
	<head>
		<title>Beverage Counter</title>
		<link href="https://rawgit.com/syncrocat/coffeerepo/master/BevCountSTYLE.css" rel="stylesheet">
	</head>
  <body>
    <p id='server-time'></p>
    <script>
      var HOST = location.origin.replace(/^http/, 'ws')
      var ws = new WebSocket(HOST);
      var el = document.getElementById('server-time');
      var mongodb = require('mongodb');
      var uri = 'mongodb://heroku_xl8h1k6v:atusortq4e2qku8pufc1cbeesb@ds163417.mlab.com:63417/heroku_xl8h1k6v';
      ws.onmessage = function (event) {

        el.innerHTML = 'Server time: ' + event.data;
        mongodb.MongoClient.connect(uri, function(err, db) {
          if(err) throw err;
          var times = db.collection('times');
          var data = { key: event.data };
          times.insert(data, function(err, result) {
            if(err) throw err;
            songs.drop(function(err) {
              if(err) throw err;
              db.close(function(err) {
                if(err) throw err;
              });
            });
          });
        });
        document.getElementById("tempIframe").src="https://rawgit.com/syncrocat/coffeerepo/master/TempData.html";
        document.getElementById("levelIframe").src="https://rawgit.com/syncrocat/coffeerepo/master/LevelData.html";
      };
    </script>

<!--
    <script>
		window.setInterval("reloadTempData();", 30000);
		function reloadTempData() {
		 document.getElementById("tempIframe").src="https://rawgit.com/syncrocat/coffeerepo/master/TempData.html";
		}
		window.setInterval("reloadLevelData();", 30000);
		function reloadLevelData() {
		 document.getElementById("levelIframe").src="https://rawgit.com/syncrocat/coffeerepo/master/LevelData.html";
		}
	</script>
	-->

    <h1>Beverage Consumption Counter</h1>
		<div class="firstBox">
			<p class="BoxText">Current temperature and level of beverage:</p>
			<!--<div class="tempBox">(temperature) </br></div>
				<div class="levelBox">(level)</br></div> -->
				<div class="tempData">
				<iframe src="https://rawgit.com/syncrocat/coffeerepo/master/TempData.html" id="tempIframe">
   				</iframe>
   				</div>
   				<div class="levelData">
   				<iframe src="https://rawgit.com/syncrocat/coffeerepo/master/LevelData.html" id="levelIframe">
   				</iframe>
   				</div>
		</div>

		<!--
		<div class="secondBox">
			<p class="BoxText">Daily log:</p>
			<div class="logBox">(Level went down by 3% at 3:00 PM etc)</br></div>
			</br>
			<input type="reset">
		</div>
		-->
  </body>
</html>
